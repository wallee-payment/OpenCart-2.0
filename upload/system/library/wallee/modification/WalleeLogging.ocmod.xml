<?xml version="1.0" encoding="utf-8"?>
<modification>
	<code>WalleeLogging</code>
	<name>wallee logging: log requests &amp; responses.
	</name>
	<version>1.0.0</version>
	<author>Customweb GmbH</author>
	<link>http://github.com/wallee-payment/opencart</link>
	<file
		path="admin/{controller,model}/extension/wallee/*.php|catalog/{controller,model}/extension/wallee/*.php|admin/controller/extension/payment/wallee.php|catalog/{controller,model}/extension/payment/wallee/*.{mock,php}|admin/{controller,model}/extension/payment/wallee/*.{mock,php}|system/library/wallee/{controller,entity,provider,service,webhook}/*.php">
		<operation>
			<search regex="true"><![CDATA[
            ~(\s*public\s+function\s+[a-zA-Z0-9]+\(.*\)\s*{)~
            ]]></search>
			<add><![CDATA[
            $1
            if(isset($registry) || isset($this->registry)) {
            	\WalleeHelper::instance(isset($registry) ? $registry : $this->registry)->log(__METHOD__, \WalleeHelper::LOG_DEBUG);
            }
            ]]></add>
		</operation>
		<operation>
			<search regex="true"><![CDATA[
            ~(catch\s*\(.*Exception\s*)(\$.+)(\s*\)\s*{)~
            ]]></search>
			<add><![CDATA[
            $1$2$3
            \WalleeHelper::instance($this->registry)->log(__METHOD__, \WalleeHelper::LOG_DEBUG);
            \WalleeHelper::instance($this->registry)->log($2->getMessage(), \WalleeHelper::LOG_ERROR);
            \WalleeHelper::instance($this->registry)->log($2->getTraceAsString(), \WalleeHelper::LOG_DEBUG);
            ]]></add>
		</operation>
	</file>
	<file path="system/library/wallee/wallee-sdk/lib/ApiClient.php">
		<operation>
			<search><![CDATA[
	private $enableDebugging = false;
            ]]></search>
			<add position="Replace"><![CDATA[
	private $enableDebugging = true;
            ]]></add>
		</operation>
		<operation>
			<search><![CDATA[
	private $debugFile = 'php://output';
            ]]></search>
			<add position="Replace"><![CDATA[
	private $debugFile = DIR_LOGS . 'wallee_communication.log';
            ]]></add>
		</operation>
		<operation>
			<search><![CDATA[
                $this->certificateAuthority = dirname(__FILE__) . '/ca-bundle.crt';
            ]]></search>
			<add position="Replace"><![CDATA[
                $this->certificateAuthority = DIR_SYSTEM . 'library/wallee/wallee-sdk/lib/ca-bundle.crt';
            ]]></add>
		</operation>
	</file>
</modification>
